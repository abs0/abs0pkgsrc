# $Id: mk.conf,v 1.303 2008/11/18 15:01:54 abs Exp $

### definitions common to pkgsrc and src
#
BSDSRCDIR?=/usr/src
OBJHOME?=/var/obj

# Use all available CPUs (could add +1 to keep things extra-busy)
.if defined(OPSYS)
. if ! defined(NCPU)
.  if ${OPSYS} == NetBSD
NCPU!=sysctl -n hw.ncpu
.  elif ${OPSYS} == Linux
NCPU!=awk '/processor/{p=$$3}END{print p}' /proc/cpuinfo
.  endif
. endif
. if ${OPSYS} == NetBSD && ${NCPU} > 1
MAKE_JOBS=${NCPU}
. endif
.endif

.if ${MACHINE} == i386
CPU_DIR=	# Lowest spec current machine is PIII and Athlon XP
CPU_FLAGS=-march=pentium3
.endif # ${MACHINE} == i386
USE_CPUFLAGS=yes

.ifdef BSD_PKG_MK
#
### pkgsrc


ACCEPTABLE_LICENSES+= \
    adobe-acrobat-license \
    artistic-2.0 \
    flash-license \
    generic-nonlicense \
    gnu-lgpl-v2.1 \
    gnu-lgpl-v3 \
    google-earth-license \
    intel-ipw-license \
    lame-license \
    libdvdcss-license \
    majordomo-license \
    mame-license \
    mozilla-trademark-license \
    mpg123-license \
    mplayer-codec-license \
    ms-ttf-license \
    no-commercial-use \
    openmotif-license \
    opera-850-license \
    pine-license \
    public-domain \
    roundcube \
    shareware \
    skype-license \
    sun-jdk6-license \
    sun-jre6-license \
    sun-jrl-16-license \
    teamspeak-license-200700213 \
    ttd-pseudolicense \
    unarj-license \
    unrar-license \
    vmware-license \
    xv-license \
    zoo-license

APACHE_MODULES+=logio
BATCH=1 # for jdk15
CREATE_WRKDIR_SYMLINK=yes
LIBDVDCSS_MASTER_SITES=http://download.videolan.org/pub/videolan/libdvdcss/
MAJORDOMO_HOMEDIR=/var
PAPERSIZE=A4
PERL5_SITEPREFIX=/usr/local/lib/perl5/site_perl
PGSQL_VERSION_DEFAULT=83
PKG_DEFAULT_OPTIONS=mmx gif pulseaudio -inet6
PKG_OPTIONS.alpine=maildir
PKG_OPTIONS.bugzilla=pgsql bugzilla-descriptions bugzilla-imagemagick bugzilla-graphicalreports bugzilla-patchviewer
PKG_OPTIONS.dvdrip=-rar
PKG_OPTIONS.exim=exim-auth-dovecot
PKG_OPTIONS.freetype2=truetype subpixel
PKG_OPTIONS.gecko=official-mozilla-branding
PKG_OPTIONS.gmplayer=-mplayer-default-cflags
PKG_OPTIONS.jdk15=jdk15-jce
PKG_OPTIONS.jdk16=jdk16-jce
PKG_OPTIONS.libpurple=dbus
PKG_OPTIONS.mencoder=faac
PKG_OPTIONS.mplayer=-mplayer-default-cflags
PKG_OPTIONS.openoffice3=firefox3 lang-en-GB
PKG_OPTIONS.openttd=ttd-data
PKG_OPTIONS.p5-HTML-Mason=-modperl
PKG_OPTIONS.roundcube=pgsql
PKG_OPTIONS.scsl-jre15=sun-jre-jce
PKG_OPTIONS.sun-jre15=sun-jre-jce
PKG_OPTIONS.vsftpd=inet6 ssl
PKG_RCD_SCRIPTS=yes
PYTHON_VERSION_DEFAULT=26
X11_TYPE=modular
USE_DESTDIR=yes

PKG_OPTIONS.x2vnc=-dga

.if defined(PKGPATH)
SKIP_DESTDIR+=chat/empathy chat/telepathy-mission-control chat/libtelepathy
SKIP_DESTDIR+=lang/pear net/pear-Net_SMTP x11/openmotif
SKIP_DESTDIR+=databases/pear-MDB2 databases/pear-MDB2_Driver_pgsql
SKIP_DESTDIR+=filesystems/fuse-ntfs-3g mail/spamassassin

SKIP_DESTDIR+=x11/qt4-qdbus textproc/libclucene
SKIP_DESTDIR+=security/qca2 textproc/rasqal x11/xine-xcb x11/qt4-mysql
SKIP_DESTDIR+=x11/xscreensaver textproc/ebook-tools textproc/convertlit

SKIP_DESTDIR+=x11/wxGTK24 # audacity

. if empty(PKG_DESTDIR_SUPPORT) && empty(META_PACKAGE) && \
	empty(SKIP_DESTDIR:M${PKGPATH})
.BEGIN:;  @echo missing PKG_DESTDIR_SUPPORT ${PKGPATH}>&2 ; exit 1 # sketch
. endif
. if (${PKGPATH} == multimedia/mplayer || ${PKGPATH} == multimedia/gmplayer)
CPU_FLAGS+=-O3 -ffast-math -fomit-frame-pointer
. endif
.endif

# XXX CPU_FLAGS+= -fomit-frame-pointer

.if defined(OPSYS)
. if ${OPSYS} == NetBSD
PKG_DEVELOPER=yes
PKGSRC_LOCKTYPE=sleep
. elif ${OPSYS} == Linux
. endif
.endif

PKG_USE_ETC=\
    audio/mserv_irman \
    audio/musicpd \
    chat/jabberd2 \
    lang/pear \
    lang/php5 \
    mail/alpine \
    mail/dovecot \
    mail/exim \
    mail/roundcube \
    mail/spamassassin \
    net/dante \
    wip/dhcpcd \
    net/netatalk \
    net/openvpn \
    net/samba \
    net/vsftpd \
    security/msu \
    security/msudir \
    security/nessus \
    security/nessus-core \
    security/nessus-libraries \
    security/nessus-plugins \
    security/sudo \
    shells/zsh \
    sysutils/dirvish \
    sysutils/libirman \
    sysutils/munin-node \
    sysutils/munin-server \
    sysutils/ups-nut \
    www/apache22 \
    www/squid \
    www/thttpd \
    x11/xdm
. if !empty(PKG_USE_ETC:M${PKGPATH})
PKG_SYSCONFBASE?=/etc
. endif

WRKOBJDIR?=${OBJHOME}/pkg
CFLAGS+=-pipe
UPDATE_TARGET=package-install
DEPENDS_TARGET=package-install
. if exists(/mono/adm)
PKGCHK_CONF?=${PKGSRCDIR}/local/config/pkgchk.mono
. else
PKGCHK_CONF?=${PKGSRCDIR}/local/config/pkgchk.conf
. endif
PKGSRCDIR?=/pkgsrc
PKG_SUFX=.tbz

# LINTPKGSRC definition should come after normal to workaround lintpkgsrc issue
. ifndef LINTPKGSRC
OS_VERSION_=${OS_VERSION:C/_.*//}
PACKAGES=${PKGSRCDIR}/packages/${OPSYS}-${OS_VERSION_}-${LOWER_ARCH}${CPU_DIR}
. else
PACKAGES=${PKGSRCDIR}/packages
. endif

.else	# BSD_PKG_MK
#
### not pkgsrc

# . if empty(TOOLDIR)
MKHESIOD	= no
MKIPFILTER	= no
MKPOSTFIX	= no
# MKX11		= yes
# X11SRCDIR	= ${BSDSRCDIR}/xsrc
STRIPFLAG      ?= -s

CPUFLAGS	= ${CPU_FLAGS}
.  sinclude "/usr/pkg/share/mk/cpuflags.mk"
# . endif # TOOLDIR

.endif	# BSD_PKG_MK
