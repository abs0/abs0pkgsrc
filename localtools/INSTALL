#!/bin/sh
#
# $NetBSD: INSTALL,v 1.4 2002/02/05 05:14:46 jlam Exp $

UPDATE_CONFIG=@PREFIX@/bin/update-config

case ${STAGE} in
POST-INSTALL)

    if [ -f /etc/rc.local ] && ! grep -q $UPDATE_CONFIG /etc/rc.local ; then
	echo "Update /etc/rc.local"
	echo "[ -x $UPDATE_CONFIG ] && $UPDATE_CONFIG" >> /etc/rc.local
    fi

    LOCAL_CSHRC=@PREFIX@/share/local/csh.cshrc
    if [ ! -f /etc/csh.cshrc ] || ! grep -q "source.*${LOCAL_CSHRC}" \
							/etc/csh.cshrc ; then
	echo "Update /etc/csh.cshrc"
	echo "if ( -f ${LOCAL_CSHRC} ) source ${LOCAL_CSHRC}" >> /etc/csh.cshrc
    fi

    for profile in /etc/zshenv /etc/profile ; do
	LOCAL_PROFILE=@PREFIX@/share/local/profile
	if [ ! -f $profile ] || ! grep -q "${LOCAL_PROFILE}" $profile ; then
	    echo "Update $profile"
	    cat >> $profile <<END
# Added by pkgsrc/localtools
ENV=/usr/pkg/share/local/profile
[ -n "$BASH_VERSION" ] && . /usr/pkg/share/local/profile

END
	fi
    done

    for f in /root/.cshrc /root/.login /root/.tcshrc ; do
	if [ -f $f ] ; then
	    echo "Removing $f"
	    rm -f $f
	fi
    done

    ;;
esac
